# Анализ и визуализация динамики баланса учеников онлайн-школы
## Задачи по проекту:
+ смоделировать изменение балансов студентов онлайн-школы в 2016 году
+ создать таблицу, где будут балансы каждого студента за каждый день
+ изучить изменения балансов студентов, найти аномалии в данных, составить список вопросов дата-инженерам и владельцам таблиц
+ визуализировать, сколько всего уроков было на балансе всех студентов за каждый календарный день, как это количество менялось под влиянием транзакций (оплат, начислений, корректирующих списаний) и уроков (списаний с баланса по мере их прохождения)
+ сделать выводы на основе визуализации
___

## Выводы по проекту:
+ В диаграмме виден рост количества транзакций с апреля месяца и сильный рост с конца сентября,
по пикам можно сказать, что оплаты проходили в начале и в конце месяца, так же можно выдвинуть гипотезу, что пики связаны с маркетинговыми акциями, либо предложением купить сразу пакет уроков, по более выгодной стоимости. Возможно, это связано с тем, что студенты в эти дни получают зарплату (аванс) и тратят на покупку уроков. 
+ Количество пройденных уроков, так же увеличивается к концу года, что говорит, об увеличении продаж, желанием студентов учиться и узнавать новое, и что привлекательность онлайн курсов растет.
+ По линии баланса видно, что студенты прошли не все оплаченные уроки и тут уже надо делать выводы.
  + А) Возможно уроки стали неинтересными, скучными или сложными. Они не соответствуют ожиданиям студентов. Если подтвердится эта гипотеза, необходимо принять меры по улучшению качества, загруженности уроков. А также необходимо будет оценить качество преподавания учителей. 

  + Б) Возможно, нет ничего критичного в такой разности баланса. Может быть такое, что студенты на конец года покупают больше уроков, чем сами проходят. Либо обычная загруженность перед концом года, либо часть уроков студенты будут проходить в следующем 2017 календарном году.

 



1) Также из графика можем увидеть, что в

определенные дни уроков было начислено больше, чем в остальные. Это можно наблюдать на стыке 2-х месяцев,  также в некоторые другие дни. Возможно, это

связано с тем, что студенты в эти дни получают зарплату (аванс) и тратят на покупку

уроков. Либо онлайн-школа проводит в эти дни проводит маркетинговые акции,

которые стимулируют студентов на покупку уроков. 
 ___

## 01. Структура базы данных skyeng_db
  1. Узнаем, когда была первая транзакция для каждого студента, начиная с этой даты, будем собирать его баланс уроков
  2. Соберем таблицу с датами за каждый календарный день 2016 года
  3. Узнаем, за какие даты имеет смысл собирать баланс для каждого студента
  4. Найдем изменения балансов студентов, связанные с успешными транзакциями
  5. Найдем баланс студентов, который сформирован только транзакциями
  6. Найдем изменения балансов студентов, связанные с прохождением уроков
  7. Найдем баланс студентов, который сформирован только прохождением уроков
  8. Найдем общий баланс студентов, сформированный транзакциями и прохождением уроков
  9. Посмотрим, как менялось общее количество уроков на балансе всех студентов
____

## 03. Визуализация динамики общего баланса всех учеников онлайн-школы
+ **sum_transaction_balance_change** - изменение общего баланса под влиянием транзакций (оплат, начислений, корректирующих списаний)
+ **sum_transaction_balance_change_cs** - кумулятивная сумма изменений общего баланса под влиянием транзакций
+ **sum_classes** - изменение общего баланса под влиянием уроков (списаний с баланса по мере их прохождения)
+ **sum_classes_cs** - кумулятивная сумма изменений общего баланса под влиянием уроков
+ **sum_balance** - общее количество уроков на балансе всех студентов
____

## 04. Таблицы с итоговыми данными, выводы и вопросы по консистентности
  ### Вопросы к дата-инженерам и владельцам таблиц:
  #### В базе за 2016 год присутствует минусовой баланс по оплаченным и пройдённым урокам.
 + Если мы выберем топ-1000 строк из CTE `balances` с сортировкой по "user_id" и "dt" и изучим  изменение баланса студентов, можем увидеть, что у некоторых студентов имеется отрицательный баланс. То есть, студенты прошли уроков больше, чем купили на самом деле. Чтобы убедиться, что это проблема действительно имеет место быть, отсортируем не по "user_id" и "dt" , а по "balance asc " и увидим, что у значительного количества студентов имеется отрицательный баланс, и он достаточно  внушителен. Это говорит о том, что дата-инженерами и владельцами таблицы `payments` совершена ошибка при заполнении данной таблицы. 
 + Дата-инженерам можно указать также и на то, что в другой таблице  «classes» имеются неточности. Например, время окончания урока раньше времени начала урока.  


1. Почему проводятся уроки, которые не оплачены студентами?
2. Как отслеживается баланс студента по оплаченным и пройденным урокам?
3. При удалении уроков не всегда проставляется информация о статусе?
4. Как так произошло, что  время окончания урока, раньше его начала?



